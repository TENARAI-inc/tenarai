第 1 週 基礎とコンポーネント

# コンポーネント

コンポーネントとは画面の構成要素としてのパーツのことである。  
ある画面をみたとき、要素をどのように細分化するか、つまりどのようにコンポーネントに分解するのかは製作者の判断による。

コンポーネントに分割することで責務が明確になったり再利用可能になったりして利点が大きい。

## シングルファイルコンポーネント

vue の世界でいうところのコンポーネントはシングルファイルコンポーネントを指す場合が多い。

これは画面のパーツとしての構成要素を一つのファイルにまとめたもので、極めて合理的であり vue の大きな特徴のひとつでもある。

具体的には

- データ構造を定義する template（html のこと）
- 見た目をデザイン通りに組み立てる （css のこと）
- ユーザーのクリックアクションやスクロールイベントなどインタラクションを担当する script（js のこと）

これらを`一つのファイル`に収めることで管理がしやすくなっている。

```
vueファイル一個の中身
機能、構造、見た目がパッケージ化されてわかりやすい
------------------------------
  // htmlに相当
  <template></template>

  // jsに相当
  <script></script>

  // cssに相当
  <style></style>
------------------------------

```

当然このファイルが担当する領域のみのコードしか書くべきではないし、そうしておけば画面上のどこに配置しても悪さをすることはない。

## コンポーネントにプロパティをセットする

コンポーネントが自分の処理しかできないとは言うものの、それだけだとあまりにも汎用性を欠く。

例えばユーザーの情報を表示するユーザーコンポーネントにはさまざまなユーザーの情報を表示する可能性がある。  
ユーザーを 3 人分表示する場合は、ユーザーコンポーネントが三つ並ぶことになる。

この場合ユーザーコンポーネントそのものは特定のユーザー情報を持つのではなく、プロパティという名前のデータ（例えば user プロパティ）を`親から渡してもらうことで`各ユーザーの情報を表示する。

コンポーネントは渡された user プロパティのさらにプロパティを使って表示を行う。

- user.name
- user.age
- user.tel

などといった具合である。  
これらを html と CSS で定義して意図した見た目のユーザーコンポーネントをつくりあげる。

```js
// ユーザーコンポーネントに親からデータ（userInfo）を渡す
// 見た目等はユーザーコンポーネントにまかせよう
<User :user-info="userInfo" />

// users配列からユーザー一覧をつくるコード
// userの数の分Userコンポーネントが生成される
<ul>
  <li v-for="user in users" :key="user.name">
    <User :user-info="user" />
  </li>
</ul>

```

## コンポーネントからイベントをもらう

データを注入して汎用コンポーネントを作成する方法を説明したがコンポーネントの仕事は表示だけではない場合が多い。  
例えば上記のユーザーコンポーネントに詳細ボタンが設置されていてクリックするとユーザーに関連するデータを取得してダイアログで表示させる場合を考える。

あなたはこの場合データ取得のコードをどこに書くだろうか  
ユーザーコンポーネントのスクリプト部分に書こうとしていないか？

それはよくない。  
コンポーネントの責務はなるべく表示のみとして`ロジック`と呼ばれるこのような処理はコンポーネント内部に書くべきではない。

::: info
この辺はチームやその設計思想によって変わるので一般的な話としてとらえておこう
:::

絶対ではないがコンポーネントは依存というものを減らしてシンプルに保つことで再利用性やバグを減らすことにつながる。  
これだとテストも追加しやすい。

代わりにやるのはイベント発行である。  
`ボタンが押されたよ`というイベントを親に通知するだけでユーザーコンポーネントの仕事は終わりとする。

### 密結合と疎結合

親はイベントを受け取り必要なデータを取得後にダイアログを表示させる。  
これでユーザーコンポーネントはシンプルに保つことができた。

親とは誰か。  
それはツリー構造の上部どこかのデータ操作に相応しい誰かであるが、最上位は`ページコンポーネント`と呼ばれている。  
ページ、つまり画面を表示する入口になる。  
基本的にこのページコンポーネントがデータ取得をするものと捉えてよい。  
ページコンポーネントは情報を fetch で取得し、そのデータを子に流し込む。  
流し込まれたコンポーネントはそのデータに基づいて空だった状態から新しい状態に自分を更新する。

このように関係するコードをなるべく少なくし自分の責務だけの最小の仕事に抑えてある状態を疎結合と呼ぶ。（逆は密結合）

コンポーネントは疎結合であることが望ましいということは押さえておきたい。

::: info
タオルとシャツとズボンが絡まり合ってしまった状態は密結合といえる。  
タオルだけ使いたいのに使おうとするとシャツもズボンもついてきて使いづらいことこの上ない。  
一方で３つを分離して個別に扱えるようにしておけば、使いたいときに使いたいものだけを利用できる。  
この理想形の状態が疎結合と言える。  
個々のパーツをなるべくシンプルに保つことで再利用しやすくバグが少ない状態を維持できる。
:::

## 共通関数（ユーティリティ）を用意して使う

再利用してコンポーネントを繰り返し使うという発想と似ているものとして共通関数がある。  
ユーティリティ関数とも呼ぶ。

これは`関数そのもの`を再利用する目的で用意された概念で、関数なので見た目は持たずに処理だけを実行し結果を返す。

> たとえば商品の値段のデータが数値でセットされているとする。  
> これを画面表示する場合円表記とカンマ区切りにしたい。
>
> あなたは値段表示箇所一個一個に数値を値段表記に変換するコードを書くだろうか？  
> それが 20 箇所もしくは 50 箇所だったら？

このように同じ処理を一度しか書かず一箇所にまとめる目的でユーティリティ関数を用意する。

```js
const priceDisp = (price: number): string => {
  return `${price.toLocaleString()}円`;
};

// template
<p>{{ priceDisp(123456) }}</p>

// 画面表示
123,456円
```

価格表示の箇所すべてにおいて数値から priceDisp 経由の円表記を出力することで`一貫性が保たれる`。  
表示ロジックに変更があっても`この一個の関数を直せばよい`。

たとえ今のところこの表示処理が一箇所しかないとしても、共通処理の可能性を感じたら積極的にユーティリティに追加すべきである。  
こんな処理は絶対にここしかないという場合を除き、処理というのはどこかしら共通で利用される可能性を考慮にいれてコードを書くのが基本だ。
